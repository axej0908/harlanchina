<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>商品管理-自营商品</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="./plugins/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="src/css/a_admin_manage.css">
    <style type="text/css">
        .layui-form-label {
            padding: 9px 3px;
            min-width: 56px;
        }

        .layui-upload {
            float: left;
            margin-left: 32px;
        }

        .layui-upload-img {
            width: 92px;
            height: 92px;
            margin: 0 10px 10px 0;
        }

        .layui-table-cell {
            height: inherit;
        }

        .txt_div {
            width: 100%;
            height: 81px;
            white-space: normal;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .img_area {
            width: 60px;
            height: 60px;
            background-size: 100% 100%;
            background-repeat: no-repeat;
            background-position: center;
            border-radius: 50%;
            border: 1px solid red;
            margin: 0 auto;
        }

        .layui-text {
            line-height: 38px;
        }

        .select_mini {
            width: 71px;
            float: left;
            margin-left: -11px;
        }
        /*输入框列表样式*/
        .input_contain{
            float: left;
            margin-left: 10px;
            width: 500px;
            margin-top: -10px;
            min-height: 44px;
        }
        .layui-input-sm-inline{
            width: 90px;
            margin-right: 10px;
            float: left;
            margin-top: 10px;
        }
        .layui-btn-area{
            float: left;
        }
        /*输入框列表样式结束*/
    </style>
    <link rel="icon" type="image/x-icon" href="imgs/favicon.ico"></head>

<body>
<div class="layui-tab layui-tab-brief layui-form" lay-filter="docDemoTabBrief">
    <ul class="layui-tab-title">
        <li class="layui-this" lay-id="0">添加商品</li>
        <li lay-id="1">上架商品</li>
        <li lay-id="2">下架商品</li>
    </ul>
    <div class="layui-tab-content" style="">
        <div class="layui-tab-item layui-show">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>添加商品</legend>
            </fieldset>
            <form class="layui-form" id="sear">
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">英文名称：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="goods_name" lay-verify="" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">商品分类：</label>
                        <div class="layui-input-inline">
                            <select name="one_type" lay-filter="one_type">
                            </select>
                        </div>
                        <div class="layui-input-inline">
                            <select name="two_type" lay-filter="two_type"></select>
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">商品价格：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="current_price" lay-verify="" autocomplete="off"
                                   class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">商品纯度：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="goods_purity" lay-verify="" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">中文名称：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="goods_name_en" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">CAS：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="cas" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">分子量：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="molecular_weight" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">PSA：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="pas" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">精确质量：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="precise_quality" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">货物规格：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="specification" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">货期：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="goods_deliver" autocomplete="off" class="layui-input">
                        </div>
                        <label class="layui-text">天</label>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">数量：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="goods_num" autocomplete="off" class="layui-input">
                        </div>
                        <div class="select_mini">
                            <select name="goods_unit" class="select_mini">
                                <option value="">吨</option>
                            </select>
                        </div>
                    </div>

                    <div class="layui-inline">
                        <label class="layui-form-label">市场价格：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="market_price" autocomplete="off" class="layui-input">
                        </div>
                        <label class="layui-text">元</label>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">付款方式：</label>
                        <div class="layui-input-block">
                            <select name="payment_opt" lay-filter="aihao">
                                <option value="">银联</option>
                                <option value="0">支付宝</option>
                                <option value="1" selected="">微信</option>
                                <option value="2">线下支付</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">运输方式：</label>
                        <div class="layui-input-block">
                            <select name="transport_opt" lay-filter="aihao">
                                <option value=""></option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">使用说明：</label>
                    <div class="layui-upload">
                        <button type="button" class="layui-btn layui-btn-normal" id="uploadC1">选择文件</button>
                        <button type="button" class="layui-btn" id="uploadB1">开始上传</button>
                        <!--hidden form -->
                        <input id="application_scheme" name="application_scheme" style="display: none;">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">商品缩略图：</label>
                    <div class="layui-upload">
                        <button type="button" class="layui-btn" id="uploadC2">上传图片</button>
                        <!--hidden form -->
                        <input id="product_picture" name="product_picture" style="display: none;">
                        <div class="layui-upload-list">
                            <img class="layui-upload-img" id="demo1">
                            <p id="demoText"></p>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">生产状态：</label>
                    <div class="layui-upload">
                        <button type="button" class="layui-btn layui-btn-normal" id="uploadC3">选择文件</button>
                        <!--hidden form -->
                        <input id="production_state" name="production_state" style="display: none;">
                        <button type="button" class="layui-btn" id="uploadB3">开始上传</button>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">检测报告：</label>
                    <div class="layui-upload">
                        <button type="button" class="layui-btn layui-btn-normal" id="uploadC4">选择文件</button>
                        <!--hidden form -->
                        <input id="detect_report" name="detect_report" style="display: none;">
                        <button type="button" class="layui-btn" id="uploadB4">开始上传</button>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">检测视频：</label>
                    <div class="layui-upload">
                        <button type="button" class="layui-btn layui-btn-normal" id="uploadC5">选择文件</button>
                        <!--hidden form -->
                        <input id="detect_video" name="detect_video" style="display: none;">
                        <button type="button" class="layui-btn" id="uploadB5">开始上传</button>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">UV数据报告：</label>
                    <div class="layui-upload">
                        <button type="button" class="layui-btn layui-btn-normal" id="uploadC6">选择文件</button>
                        <!--hidden form -->
                        <input id="detect_uv" name="detect_uv" style="display: none;">
                        <button type="button" class="layui-btn" id="uploadB6">开始上传</button>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">测色数据报告：</label>
                    <div class="layui-upload">
                        <button type="button" class="layui-btn layui-btn-normal" id="uploadC7">选择文件</button>
                        <!--hidden form -->
                        <input id="detect_colourimeter" name="detect_colourimeter" style="display: none;">
                        <button type="button" class="layui-btn" id="uploadB7">开始上传</button>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">样品图片：</label>
                    <div class="layui-upload">
                        <button type="button" class="layui-btn" id="uploadC8">上传图片</button>
                        <!--hidden form -->
                        <input id="detect_sample_imgs" name="detect_sample_imgs" style="display: none;">
                        <div class="layui-upload-list">
                            <img class="layui-upload-img" id="demo1">
                            <p id="demoText"></p>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">大货图片：</label>
                    <div class="layui-upload">
                        <button type="button" class="layui-btn" id="uploadC9">上传图片</button>
                        <!--hidden form -->
                        <input id="detect_bulk_imgs" name="detect_bulk_imgs" style="display: none;">
                        <div class="layui-upload-list">
                            <img class="layui-upload-img" id="demo1">
                            <p id="demoText"></p>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">包装：</label>
                        <div class="input_contain">
                            <div class="layui-input-sm-inline">
                                <input type="text" name="package_opt" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-btn-area">
                            <div class="layui-btn add_btn" data-nm="package_opt">增加</div>
                            <div class="layui-btn del_btn">删除</div>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">强度(色力)：</label>
                        <div class="input_contain">
                            <div class="layui-input-sm-inline">
                                <input type="text" name="color_power" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-btn-area">
                            <div class="layui-btn add_btn" data-nm="color_power">增加</div>
                            <div class="layui-btn del_btn">删除</div>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">强色光：</label>
                        <div class="input_contain">
                            <div class="layui-input-sm-inline">
                                <input type="text" name="color_light" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-btn-area">
                            <div class="layui-btn add_btn" data-nm="color_light">增加</div>
                            <div class="layui-btn del_btn">删除</div>
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">

                    <div class="layui-inline">
                        <label class="layui-form-label">外观要求：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="quality_aspect" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">水分：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="quality_moisture" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">不溶物要求：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="quality_insoluble" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">溶解度：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="quality_solubility" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">氯离子含量：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="quality_clContent" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">盐分：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="quality_salinity" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">电导率：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="quality_conductivity" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">米氏酮：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="quality_michlerKetone" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">固含量要求：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="quality_solidContent" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">铜离子：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="metal_cu" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">铅离子：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="metal_pb" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">锌离子：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="metal_zn" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">锡离子：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="metal_sn" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">镍离子：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="metal_ni" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">钴离子：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="metal_co" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">锑离子：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="metal_sb" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">汞离子：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="metal_hg" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">镉离子：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="metal_cd" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">铋离子：</label>
                        <div class="layui-input-inline">
                            <input type="text" name="metal_bi" autocomplete="off" class="layui-input">
                            <input type="text" name="goods_type" value="harlan_normal" style="display: none;">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-input-block">
                            <button class="layui-btn" lay-submit lay-filter="demo1">立即提交</button>
                            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="layui-tab-item ">
            <!--筛选条件开始-->
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">商品编号：</label>
                    <div class="layui-input-inline">
                        <input type="text" name="goods_id" lay-verify="searchId" autocomplete="off"
                               class="layui-input">
                    </div>
                </div>
                <button class="layui-btn" lay-submit lay-filter="searchId">搜索</button>

                <div class="layui-inline">
                    <label class="layui-form-label">商品名称：</label>
                    <div class="layui-input-inline">
                        <input type="text" name="goods_name" lay-verify="searchName" autocomplete="off"
                               class="layui-input">
                    </div>
                </div>
                <button class="layui-btn" lay-submit lay-filter="search">搜索</button>

                <div class="layui-inline">
                    <label class="layui-form-label">cas：</label>
                    <div class="layui-input-inline">
                        <input type="text" name="cas" lay-verify="searchCas" autocomplete="off"
                               class="layui-input">
                    </div>
                </div>
                <button class="layui-btn" lay-submit lay-filter="searchCas">搜索</button>
            </div>
            <!--筛选条件结束-->
            <table class="layui-table" lay-filter="test" id="test"></table>
        </div>
    </div>
</div>
<!--商品名称模板-->
<script type="text/html" id="goodimg">
    <div class="img_area" style="background-image:url(/{{d.product_picture}});"></div>
</script>
<!--表格工具条模板一-->
<script type="text/html" id="barDemo">
    <!--<a class="layui-btn layui-btn-mini" lay-event="alter">编辑</a>-->
    <!--<a class="layui-btn layui-btn-mini" lay-event="detail">查看详情</a>-->
    <a class="layui-btn layui-btn-warm layui-btn-mini" lay-event="add">添加化合物</a>

    {{# if(d.goods_state == 'up'){ }}
    <!--<a class="layui-btn layui-btn-mini" lay-event="alter">编辑</a>-->
    <a class="layui-btn layui-btn-mini" lay-event="detail">查看详情</a>
    <a class="layui-btn layui-btn-danger layui-btn-mini" lay-event="pull">下架</a>
    {{# if(d.hot_sales == 'not'){ }}
    <a class="layui-btn layui-btn-normal layui-btn-mini" lay-event="setHot">设置热销</a>
    {{# } }}
    {{# if(d.hot_sales == 'yes'){ }}
    <a class="layui-btn layui-btn-normal layui-btn-mini" lay-event="cancelHot">取消热销</a>
    {{# } }}
    {{# } }}

    {{# if(d.goods_state == 'down'){ }}
    <a class="layui-btn layui-btn-mini" lay-event="alter">编辑</a>
    <a class="layui-btn layui-btn-mini" lay-event="detail">查看详情</a>
    <!--<a class="layui-btn layui-btn-mini" lay-event="edit">编辑</a>-->
    <a class="layui-btn layui-btn-mini" lay-event="put">上架</a>
    <a class="layui-btn layui-btn-danger layui-btn-mini" lay-event="del">删除</a>
    {{# } }}
</script>
<!---->
<script src="./plugins/layui/layui.js"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script>
    var form, $;
    layui.use(['form', 'layedit', 'laydate', "element", "table", "upload", "jquery", "layer"], function () {
        form = layui.form;
        $ = layui.jquery;
        var layer = parent.layer === undefined ? layui.layer : parent.layer;
        var layer = layui.layer,
            laydate = layui.laydate,
            table = layui.table,
            element = layui.element,
            upload = layui.upload;


        //***********preload
        var goods_state = 'up';
        $(function () {
            //step1:preload产品
            var criteria = {goods_type: "harlan_", goods_state: goods_state};
            initTable(criteria);

            //step2:preload分类
            preLoadGoodsCate();
        });

        /**
         * 11.表格操作
         */
        /*table.on('tool(test)', function (obj) {
            var rowObj = obj.data;
            var layEvent = obj.event;
            if (layEvent == 'edit') {
                element.tabAdd('docDemoTabBrief', {
                    title: '查看详情',content: '选项卡的内容' //支持传入html
                    ,id: '选项卡标题的lay-id属性值'
                });
            }
        });*/

        //10.9 大货图片 文件上传
        upload.render({
            elem: '#uploadC9',
            url: '/file/upload',
            done: function (r) {
                if (r.code == 0) {
                    $("#detect_bulk_imgs").val(r.data);
                    layer.msg("success");
                }
            }
        });

        //10.8 样品图片 文件上传
        upload.render({
            elem: '#uploadC8',
            url: '/file/upload',
            done: function (r) {
                if (r.code == 0) {
                    $("#detect_sample_imgs").val(r.data);
                    layer.msg("success");
                }
            }
        });

        //10.7 测色仪数据 文件上传
        upload.render({
            elem: '#uploadC7',
            url: '/file/upload',
            bindAction: '#uploadC7',
            done: function (r) {
                if (r.code == 0) {
                    $("#detect_colourimeter").val(r.data);
                    layer.msg("success");
                }
            }
        });

        //10.6 UV数据报告 文件上传
        upload.render({
            elem: '#uploadC6',
            url: '/file/upload',
            bindAction: '#uploadC6',
            done: function (r) {
                if (r.code == 0) {
                    $("#detect_uv").val(r.data);
                    layer.msg("success");
                }
            }
        });

        //10.5 检测视频 文件上传
        upload.render({
            elem: '#uploadC5',
            url: '/file/upload',
            bindAction: '#uploadC5',
            done: function (r) {
                if (r.code == 0) {
                    $("#detect_video").val(r.data);
                    layer.msg("success");

                }
            }
        });

        //10.4 检测报告 文件上传
        upload.render({
            elem: '#uploadC4',
            url: '/file/upload',
            bindAction: '#uploadC4',
            done: function (r) {
                if (r.code == 0) {
                    $("#detect_report").val(r.data);
                }
            }
        });

        //10.3 生产状态 文件上传
        upload.render({
            elem: '#uploadC3',
            url: '/file/upload',
            bindAction: '#uploadC3',
            done: function (r) {
                if (r.code == 0) {
                    $("#production_state").val(r.data);
                    layer.msg("success");
                }
            }
        });

        //10.2 产品图片 文件上传
        upload.render({
            elem: '#uploadC2',
            url: '/file/upload',
            done: function (r) {
                if (r.code == 0) {
                    layer.msg("success");

                    $("#product_picture").val(r.data);
                }
            }
        });

        //10.1 应用方案/使用说明文件上传
        upload.render({
            elem: '#uploadC1',
            url: '/file/upload/',
            auto: false,
            accept: "file",
            bindAction: '#uploadB1',
            done: function (r) {
                if (r.code == 0) {
                    layer.msg("success");
                    $("#application_scheme").val(r.data);
                }
            }
        });

        /**
         * 9.submit form
         */
        form.on('submit(demo1)', function (data) {
            console.log(data.field);
            console.log($("#sear").serialize());
            $.ajax({
                url: '/goodsMall/save',
                type: 'post',
                data: $("#sear").serialize(),
                dataType: 'json',
                success: function (r) {
                    if (r.code == 0) {
                        layer.open({
                            content: '添加成功!'
                        });
                        /*window.location.href = "h_goods_a.html";*/
                    }else {
                        layer.open({
                            content: '添加失败!'
                        });
                        /*alert("fail to add，Product name no repetition allowed!");*/
                        /*window.location.href = "h_goods_a.html";*/
                    }
                }
            });
            return false;
        });

        //8 二级分类联动事件
        form.on('select(one_type)', function (data) {
            var selTopCate = data.value;
            categories.forEach(function (item, index) {
                if (item.text == selTopCate) {
                    var secCateStr = initCateStr(item.list);
                    $('select[name=two_type]').html(secCateStr);
                    form.render('select');
                }
            })
        });


        /**
         * 7.赋值下拉框
         */
        function initCateStr(arr) {
            var strVal = '<option>请选择</option>';
            if (typeof arr == "undefined") {
                return strVal;
            } else {
                for (var i = 0; i < arr.length; i++) {
                    //step2.1初始化下拉菜单
                    strVal += '<option value="' + arr[i].text + '">' + arr[i].text + '</option>';
                }
            }
            return strVal;
        }


        /**
         * 6.preload all categories of goods
         */
        function preLoadGoodsCate() {
            $.ajax({
                url: "/category/recursion",
                type: "post",
                data: {},
                dataType: 'json',
                success: function (r) {
                    categories = r.data;
                    var topCateStr = initCateStr(categories);
                    $('select[name=one_type]').html(topCateStr);
                    form.render();
                }
            })
        }

        /**
         * Hot Products
         */
        function hotGoods(goods_id, hot_sales) {
            $.ajax({
                url: '/goodsMall/update',
                data: {
                    "goods_id": goods_id,
                    "hot_sales": hot_sales
                },
                type: "post",
                dataType: "json",
                success : function (r) {
                    if(r.code == 0){
                        layer.open({
                            content: 'success'
                        });
                    }else {
                        layer.open({
                            content: 'fail'
                        });
                    }
                }
            })
        }

        /**
         * 5.operate row obj
         */
        table.on('tool(test)', function (obj) {
            var data = obj.data;
            var layEvent = obj.event;
            var tr = obj.tr;

            //off shelve
            if (layEvent === 'pull') {
                putOrPullGoods(obj.data.goods_id, -1)
            } else if (layEvent === 'put') {
                //on shelve
                putOrPullGoods(obj.data.goods_id, 1)
            }

            //hot sales
            if(layEvent === 'setHot'){
                var hot_sales = 'yes';
                hotGoods(data.goods_id, hot_sales);
            }else if(layEvent === 'cancelHot'){
                var hot_sales = 'not';
                hotGoods(data.goods_id, hot_sales);
            }

            if(layEvent === 'alter'){
                window.location.href = "gd_edit.html?goods_id="+data.goods_id;
            }

            //添加化合物
            if(layEvent === 'add'){
                window.location.href = "sys_add_cpd.html?goods_id="+data.goods_id;
            }

            //查看详情
            if(layEvent === 'detail'){ //开始找货
                //向服务端发送编辑指令
                /*window.location.href = "../g_goods_detail.html?goods_id="+goods_id;*/
                window.open("../g_goods_detail.html?goods_id="+data.goods_id)
            }

            //删除
            if(layEvent === 'del'){
                layer.confirm('确认删除', function (index) {
                    layer.close(index);
                    $.ajax({
                        url:'/goodsMall/delete',
                        data:{
                            goods_id:data.goods_id
                        },
                        type:"post",
                        dataType:"json",
                        success : function (r) {
                            if(r.code == 0){
                                layer.open({
                                    content: '删除成功!'
                                });
                            }else {
                                layer.open({
                                    content: '删除失败!'
                                });
                            }
                        }
                    })
                });
            }
        });

        /**
         * 4.put goods onShelve or offShelve
         */
        function putOrPullGoods(goods_id, way) {
            $.ajax({
                url: way > 0 ? '/goodsMall/onShelve' : '/goodsMall/offShelve',
                type: "post",
                data: {goods_id: goods_id},
                dataType: "json",
                success: function (r) {
                    if (r.code == 0) {
                        var criteria = {goods_type: "harlan_", goods_state: goods_state};
                        initTable(criteria);
                        layer.msg("success");
                    }
                }
            })
        }

        /**
         * 3.search by criteria
         */
        form.on('submit(search)', function (data) {
            console.log(data.field);
            var param = {
                goods_type: "harlan_",
                goods_state: goods_state,
                goods_name: data.field.goods_name,
                goods_id: data.field.goods_id
            };
            initTable(param);
            return false;
        });

        /**
         * 商品编号 搜索
         */
        form.on('submit(searchId)', function (data) {
            console.log(data.field);
            table.reload('test',{
                url:'/cmsGoods/searchId',
                where: {
                    goods_id: data.field.goods_id
                }
            });
        });


        /**
         * cas 搜索
         */
        form.on('submit(searchCas)', function (data) {
            console.log(data.field);
            table.reload('test',{
                url:'/cmsGoods/searchCas',
                where: {
                    cas:data.field.cas
                }
                ,page: {
                    curr: 1
                }
            });
        });

        /**
         * 2.switch tab
         */
        element.on('tab(docDemoTabBrief)', function (data) {
            console.log(data.index); //得到当前Tab的所在下标
            if (data.index == 1) {
                goods_state = 'up';
                var criteria = {goods_type: "harlan_", goods_state: goods_state};
                initTable(criteria);
            } else if (data.index == 2) {
                goods_state = 'down';
                var criteria = {goods_type: "harlan_", goods_state: goods_state};
                initTable(criteria);
            }
        });

        /**
         * 1.render table
         * @param criteria
         */
        function initTable(criteria) {
            table.render({
                elem: '#test',
                url: '/cmsGoods/pager',
                height: 'full-160',
                where: criteria,
                cols: [[
                    //{type:'checkbox'}
                    {field: 'goods_id', title: '商品编号', sort: true},
                    {field: 'product_picture', title: '商品缩略图', templet: '#goodimg'},
                    {field: 'create_time', title: '发布时间'},
                    {field: 'goods_name', title: '商品名称'},
                    {field: 'two_type', title: '所属类别'},
                    {field: 'current_price', title: '商品价格'},
                    {field: 'goods_num', title: '剩余数量'},
                    {field: 'optate', title: '操作', width: "500", toolbar: '#barDemo'}
                ]],
                page: true, limit: 10
            });
        }
        //按钮添加删除
        //添加
        $(".layui-btn-area").on("click",".add_btn",function(){
            var input_con = $(this).parent().siblings(".input_contain");
            var item = $('<div class="layui-input-sm-inline"><input type="text" class="layui-input"></div>');
            item.find("input").attr("name",$(this).data("nm"));
            // if($(this).data("nm") == "package_opt"){

            // }else if($(this).data("nm") == "color_power"){

            // }else if($(this).data("nm") == "color_light"){

            // }
            input_con.append(item)
        })
        //删除
        /*$(".layui-btn-area").on("click",".del_btn",function(){
            var input_con = $(this).parent().siblings(".input_contain");
            input_con.find(".layui-input-sm-inline").last().remove()
        })*/
    });
</script>

</body>

</html>